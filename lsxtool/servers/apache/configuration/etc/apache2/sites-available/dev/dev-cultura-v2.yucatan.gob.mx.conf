# Configuración para dev-cultura-v2.yucatan.gob.mx - Apache Puerto 9200
# Aplicación Vue (template-vue)
#
# Si sigue apareciendo X-Frame-Options: deny:
# 1. Comprobar: curl -I https://dev-cultura-v2.yucatan.gob.mx/  (debe verse X-Frame-Options: SAMEORIGIN)
# 2. Buscar en la app (template-vue): <meta http-equiv="X-Frame-Options" content="deny"> y quitarlo del index.html
# 3. Buscar en la app .htaccess: Header set X-Frame-Options deny → quitarlo o cambiar a SAMEORIGIN
# 4. Recargar Apache y Traefik después de desplegar este conf

<VirtualHost *:9200>
    ServerName dev-cultura-v2.yucatan.gob.mx

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/dev-cultura-v2_yucatan_gob_mx-error.log
    CustomLog ${APACHE_LOG_DIR}/dev-cultura-v2_yucatan_gob_mx-access.log combined

    # Root del frontend (template-vue)
    DocumentRoot /mnt/d/www/01-STIC/web/00-CORE/template-vue/application
    DirectoryIndex index.html index.htm index.php

    # --- Frontend normal (template-vue) ---
    <Directory /mnt/d/www/01-STIC/web/00-CORE/template-vue/application>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Forzar SAMEORIGIN aquí (dentro de Directory) para ganar sobre .htaccess y respuestas PHP
        Header always unset X-Frame-Options
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set Content-Security-Policy "frame-ancestors 'self'"
        
        # PHP-FPM para archivos PHP
        <FilesMatch \.php$>
            SetHandler "proxy:unix:/var/run/php/php7.4-fpm.sock|fcgi://localhost/"
        </FilesMatch>
        
        # Rewrite: Si el archivo estático no existe, devolver 404 (no redirigir a index.html)
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ [NC]
        RewriteRule . - [R=404,L]
    </Directory>

    # Archivos estáticos (con caché y tipos MIME correctos)
    <LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
        # Asegurar tipo MIME correcto
        # Asegurar tipo MIME correcto para CSS
        <If "%{REQUEST_URI} =~ /\.css$/">
            ForceType text/css
        </If>
        # Asegurar tipo MIME correcto para JS
        <If "%{REQUEST_URI} =~ /\.js$/">
            ForceType application/javascript
        </If>
        # Caché para archivos estáticos
        Header set Cache-Control "public, max-age=31536000, immutable"
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
    </LocationMatch>

    # SAMEORIGIN a nivel vhost (por si alguna location no está en el Directory anterior)
    Header always unset X-Frame-Options
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set Content-Security-Policy "frame-ancestors 'self'"
</VirtualHost>

