# Configuración para dev-recibonomina.yucatan.gob.mx - Apache Puerto 9200
# Aplicación Laravel

<VirtualHost *:9200>
    ServerName dev-recibonomina.yucatan.gob.mx

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/dev-recibonomina_yucatan_gob_mx-error.log
    CustomLog ${APACHE_LOG_DIR}/dev-recibonomina_yucatan_gob_mx-access.log combined
    
    # Optimizaciones de rendimiento Apache
    KeepAlive On
    KeepAliveTimeout 5
    MaxKeepAliveRequests 100
    
    # Timeouts optimizados (300s para operaciones largas de Laravel)
    Timeout 300
    
    # Deshabilitar logging de acceso para archivos estáticos (mejora rendimiento)
    SetEnvIf Request_URI "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp)$" dontlog
    
    # ProxyTimeout global para FastCGI (aplicado a nivel VirtualHost)
    ProxyTimeout 300

    # Root de Laravel (directorio public)
    DocumentRoot /mnt/d/www/01-STIC/web/recibonomina/app/public
    DirectoryIndex index.php index.html index.htm

    # --- Directorio principal de Laravel ---
    <Directory /mnt/d/www/01-STIC/web/recibonomina/app/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # PHP-FPM para PHP 7.4 con optimizaciones de rendimiento
        <FilesMatch \.php$>
            SetHandler "proxy:unix:/var/run/php/php7.4-fpm.sock|fcgi://localhost/"
        </FilesMatch>
        # Nota: ProxyTimeout está configurado a nivel VirtualHost (línea 23)
        
        # Rewrite rules para Laravel
        RewriteEngine On
        
        # Redirigir todo a index.php si el archivo o directorio no existe
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ index.php [L]
    </Directory>

    # Archivos estáticos (con caché y tipos MIME correctos)
    <LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp)$">
        # Asegurar tipo MIME correcto para CSS
        <If "%{REQUEST_URI} =~ /\.css$/">
            ForceType text/css
        </If>
        # Asegurar tipo MIME correcto para JS
        <If "%{REQUEST_URI} =~ /\.js$/">
            ForceType application/javascript
        </If>
        # Caché para archivos estáticos
        Header set Cache-Control "public, max-age=31536000, immutable"
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
    </LocationMatch>

    # Denegar acceso a archivos sensibles (pero permitir .htaccess para Laravel)
    <FilesMatch "^(\.env|\.git|composer\.(json|lock)|package\.json|yarn\.lock|artisan)$">
        Require all denied
    </FilesMatch>
</VirtualHost>

