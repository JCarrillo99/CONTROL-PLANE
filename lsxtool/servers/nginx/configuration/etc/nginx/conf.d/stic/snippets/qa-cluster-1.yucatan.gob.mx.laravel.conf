# Laravel backend routes (API & Swagger fallback)

    # API routes - Laravel maneja el routing vía PHP-FPM
    location /api/ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME /mnt/d/www/01-STIC/web/00-CORE/cluster-1/public/index.php;
        include fastcgi_params;

        # Timeouts para Laravel
        fastcgi_read_timeout 300s;
        fastcgi_send_timeout 300s;
        fastcgi_connect_timeout 60s;

        # Buffers para Laravel
        fastcgi_buffer_size 128k;
        fastcgi_buffers 4 256k;
        fastcgi_busy_buffers_size 256k;
        fastcgi_temp_file_write_size 256k;

        # Headers para Laravel
        fastcgi_param HTTP_X_FORWARDED_PROTO https;
        fastcgi_param HTTP_X_FORWARDED_FOR $http_x_forwarded_for;
        fastcgi_param HTTP_X_FORWARDED_HOST $host;
        fastcgi_param HTTPS on;

        # Certificado de cliente (si Traefik lo envía)
        fastcgi_param SSL_CLIENT_CERT $http_x_ssl_client_cert;
        fastcgi_param SSL_CLIENT_VERIFY $http_x_ssl_client_verify;
        fastcgi_param SSL_CLIENT_S_DN $http_x_ssl_client_s_dn;
        fastcgi_param SSL_CLIENT_FINGERPRINT $http_x_ssl_client_fingerprint;

        fastcgi_param REQUEST_URI $request_uri;
    }

    # Swagger (HTML) - se atiende desde Laravel
    location /docs {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME /mnt/d/www/01-STIC/web/00-CORE/cluster-1/public/index.php;
        include fastcgi_params;

        fastcgi_read_timeout 300s;
        fastcgi_send_timeout 300s;
        fastcgi_connect_timeout 60s;

        fastcgi_buffer_size 128k;
        fastcgi_buffers 4 256k;
        fastcgi_busy_buffers_size 256k;
        fastcgi_temp_file_write_size 256k;

        fastcgi_param HTTP_X_FORWARDED_PROTO https;
        fastcgi_param HTTP_X_FORWARDED_FOR $http_x_forwarded_for;
        fastcgi_param HTTP_X_FORWARDED_HOST $host;
        fastcgi_param HTTPS on;

        fastcgi_param SSL_CLIENT_CERT $http_x_ssl_client_cert;
        fastcgi_param SSL_CLIENT_VERIFY $http_x_ssl_client_verify;
        fastcgi_param SSL_CLIENT_S_DN $http_x_ssl_client_s_dn;
        fastcgi_param SSL_CLIENT_FINGERPRINT $http_x_ssl_client_fingerprint;

        fastcgi_param REQUEST_URI $request_uri;
    }

    # Fallback para Swagger cuando el archivo no existe
    location @swagger_laravel {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME /mnt/d/www/01-STIC/web/00-CORE/cluster-1/public/index.php;
        include fastcgi_params;

        fastcgi_param HTTP_X_FORWARDED_PROTO https;
        fastcgi_param HTTP_X_FORWARDED_FOR $http_x_forwarded_for;
        fastcgi_param HTTP_X_FORWARDED_HOST $host;
        fastcgi_param HTTPS on;
        fastcgi_param REQUEST_URI $request_uri;
    }


