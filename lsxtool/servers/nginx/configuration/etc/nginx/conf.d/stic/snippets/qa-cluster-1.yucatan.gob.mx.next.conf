# Next.js static & fallback routing

    # Archivos públicos comunes
    location ~ \.(png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|json|xml|txt)$ {
        root /mnt/d/www/01-STIC/web/00-CORE/cluster-1-front;
        try_files /public$uri $uri =404;
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    location ~ ^/(next\.svg|vercel\.svg|favicon\.ico|robots\.txt|sitemap\.xml)$ {
        root /mnt/d/www/01-STIC/web/00-CORE/cluster-1-front/public;
        try_files $uri =404;
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # Rutas principales del frontend Next.js
    location / {
        try_files $uri $uri.html $uri/index.html /index.html @nextjs_server;
    }

    # Fallback al servidor Next.js (modo desarrollo)
    location @nextjs_server {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;

        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;

        proxy_intercept_errors on;
        error_page 502 503 504 = @nextjs_error;
    }

    location @nextjs_error {
        default_type text/html;
        return 502 "<html><body><h1>502 Bad Gateway</h1><p>Next.js server no está disponible.</p><p>Para iniciar: cd /mnt/d/www/01-STIC/web/00-CORE/cluster-1-front && npm start</p></body></html>";
    }

    # Recursos estáticos generados por Next.js
    location /_next/static {
        alias /mnt/d/www/01-STIC/web/00-CORE/cluster-1-front/.next/static;
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    location /public/ {
        alias /mnt/d/www/01-STIC/web/00-CORE/cluster-1-front/public/;
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }


